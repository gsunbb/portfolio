<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ë¦¬ë°˜ ê°ì • ì²´í¬ì¸ ì‹œìŠ¤í…œ V3.5</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .emotion-card {
            transition: all 0.3s ease;
            transform: scale(1);
            position: relative;
            overflow: hidden;
        }
        .emotion-card:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }
        .emotion-card:active {
            transform: scale(0.98);
        }
        .tab-active {
            background: rgba(255,255,255,0.2);
            border-bottom: 3px solid #fff;
        }
        .chart-container {
            height: 400px;
        }
        .quantity-control {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            opacity: 0;
            transform: translateY(100%);
            transition: all 0.3s ease;
        }
        .emotion-card:hover .quantity-control {
            opacity: 1;
            transform: translateY(0);
        }
        .quantity-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(5px);
        }
        .quantity-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }
        .quantity-btn:active {
            transform: scale(0.9);
        }
        .quantity-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .quantity-btn:disabled:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1);
        }
        .quantity-display {
            color: white;
            font-weight: bold;
            font-size: 14px;
            min-width: 40px;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        .emotion-main {
            padding: 24px 16px 48px 16px;
            cursor: pointer;
            height: 100%;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .emotion-emoji {
            font-size: 3rem;
            margin-bottom: 8px;
        }
        .emotion-name {
            font-size: 1.125rem;
            font-weight: bold;
            margin-bottom: 4px;
        }
        .emotion-count {
            font-size: 0.875rem;
            opacity: 0.8;
        }
        .mobile-controls {
            display: none;
            margin-top: 12px;
            padding: 12px;
            background: rgba(0,0,0,0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        @media (max-width: 768px) {
            .quantity-control {
                position: static;
                opacity: 1;
                transform: translateY(0);
                background: rgba(0,0,0,0.15);
                border-top: none;
                border-radius: 0 0 12px 12px;
            }
            .emotion-card:hover .quantity-control {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">ìš°ë¦¬ë°˜ ê°ì • ì²´í¬ì¸</h1>
            <p class="text-white opacity-80 text-lg" id="currentDate"></p>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="flex justify-center mb-6">
            <div class="bg-white bg-opacity-20 rounded-lg p-1 flex">
                <button onclick="showTab('checkin')" id="tab-checkin" class="tab-active px-6 py-2 rounded-lg text-white font-medium transition-all">ì²´í¬ì¸</button>
                <button onclick="showTab('today-stats')" id="tab-today-stats" class="px-6 py-2 rounded-lg text-white font-medium transition-all">ì˜¤ëŠ˜ í†µê³„</button>
                <button onclick="showTab('weekly-stats')" id="tab-weekly-stats" class="px-6 py-2 rounded-lg text-white font-medium transition-all">ì£¼ê°„ í†µê³„</button>
                <button onclick="showTab('admin')" id="tab-admin" class="px-6 py-2 rounded-lg text-white font-medium transition-all">ê´€ë¦¬ì</button>
            </div>
        </div>

        <!-- ì²´í¬ì¸ í˜ì´ì§€ -->
        <div id="checkin-page" class="tab-content">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-white mb-4">ì˜¤ëŠ˜ ê¸°ë¶„ì€ ì–´ë– ì„¸ìš”?</h2>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto">
                <div class="emotion-card bg-yellow-400 hover:bg-yellow-300 text-white rounded-xl shadow-lg relative">
                    <div class="emotion-main" onclick="addEmotion('ê¸°ì¨')">
                        <div class="emotion-emoji">ğŸ˜Š</div>
                        <div class="emotion-name">ê¸°ì¨/ì¦ê±°ì›€</div>
                        <div class="emotion-count" id="count-ê¸°ì¨">0ëª…</div>
                    </div>
                    <div class="quantity-control">
                        <button class="quantity-btn" onclick="decreaseEmotion('ê¸°ì¨')" id="decrease-ê¸°ì¨">
                            <i class="fas fa-minus"></i>
                        </button>
                        <div class="quantity-display" id="quantity-ê¸°ì¨">0</div>
                        <button class="quantity-btn" onclick="increaseEmotion('ê¸°ì¨')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <div class="emotion-card bg-gray-400 hover:bg-gray-300 text-white rounded-xl shadow-lg relative">
                    <div class="emotion-main" onclick="addEmotion('ë³´í†µ')">
                        <div class="emotion-emoji">ğŸ˜</div>
                        <div class="emotion-name">ë³´í†µ/í‰ì˜¨</div>
                        <div class="emotion-count" id="count-ë³´í†µ">0ëª…</div>
                    </div>
                    <div class="quantity-control">
                        <button class="quantity-btn" onclick="decreaseEmotion('ë³´í†µ')" id="decrease-ë³´í†µ">
                            <i class="fas fa-minus"></i>
                        </button>
                        <div class="quantity-display" id="quantity-ë³´í†µ">0</div>
                        <button class="quantity-btn" onclick="increaseEmotion('ë³´í†µ')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <div class="emotion-card bg-blue-500 hover:bg-blue-400 text-white rounded-xl shadow-lg relative">
                    <div class="emotion-main" onclick="addEmotion('ìŠ¬í””')">
                        <div class="emotion-emoji">ğŸ˜¢</div>
                        <div class="emotion-name">ìŠ¬í””/ìš°ìš¸</div>
                        <div class="emotion-count" id="count-ìŠ¬í””">0ëª…</div>
                    </div>
                    <div class="quantity-control">
                        <button class="quantity-btn" onclick="decreaseEmotion('ìŠ¬í””')" id="decrease-ìŠ¬í””">
                            <i class="fas fa-minus"></i>
                        </button>
                        <div class="quantity-display" id="quantity-ìŠ¬í””">0</div>
                        <button class="quantity-btn" onclick="increaseEmotion('ìŠ¬í””')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <div class="emotion-card bg-red-500 hover:bg-red-400 text-white rounded-xl shadow-lg relative">
                    <div class="emotion-main" onclick="addEmotion('í™”ë‚¨')">
                        <div class="emotion-emoji">ğŸ˜ </div>
                        <div class="emotion-name">í™”ë‚¨/ì§œì¦</div>
                        <div class="emotion-count" id="count-í™”ë‚¨">0ëª…</div>
                    </div>
                    <div class="quantity-control">
                        <button class="quantity-btn" onclick="decreaseEmotion('í™”ë‚¨')" id="decrease-í™”ë‚¨">
                            <i class="fas fa-minus"></i>
                        </button>
                        <div class="quantity-display" id="quantity-í™”ë‚¨">0</div>
                        <button class="quantity-btn" onclick="increaseEmotion('í™”ë‚¨')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <div class="emotion-card bg-orange-500 hover:bg-orange-400 text-white rounded-xl shadow-lg relative">
                    <div class="emotion-main" onclick="addEmotion('ë¶ˆì•ˆ')">
                        <div class="emotion-emoji">ğŸ˜°</div>
                        <div class="emotion-name">ë¶ˆì•ˆ/ê±±ì •</div>
                        <div class="emotion-count" id="count-ë¶ˆì•ˆ">0ëª…</div>
                    </div>
                    <div class="quantity-control">
                        <button class="quantity-btn" onclick="decreaseEmotion('ë¶ˆì•ˆ')" id="decrease-ë¶ˆì•ˆ">
                            <i class="fas fa-minus"></i>
                        </button>
                        <div class="quantity-display" id="quantity-ë¶ˆì•ˆ">0</div>
                        <button class="quantity-btn" onclick="increaseEmotion('ë¶ˆì•ˆ')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <div class="emotion-card bg-purple-600 hover:bg-purple-500 text-white rounded-xl shadow-lg relative">
                    <div class="emotion-main" onclick="addEmotion('í”¼ê³¤')">
                        <div class="emotion-emoji">ğŸ˜´</div>
                        <div class="emotion-name">í”¼ê³¤/ë¬´ê¸°ë ¥</div>
                        <div class="emotion-count" id="count-í”¼ê³¤">0ëª…</div>
                    </div>
                    <div class="quantity-control">
                        <button class="quantity-btn" onclick="decreaseEmotion('í”¼ê³¤')" id="decrease-í”¼ê³¤">
                            <i class="fas fa-minus"></i>
                        </button>
                        <div class="quantity-display" id="quantity-í”¼ê³¤">0</div>
                        <button class="quantity-btn" onclick="increaseEmotion('í”¼ê³¤')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <div class="emotion-card bg-pink-500 hover:bg-pink-400 text-white rounded-xl shadow-lg relative">
                    <div class="emotion-main" onclick="addEmotion('ì„¤ë ˜')">
                        <div class="emotion-emoji">ğŸ¤—</div>
                        <div class="emotion-name">ì„¤ë ˜/ê¸°ëŒ€</div>
                        <div class="emotion-count" id="count-ì„¤ë ˜">0ëª…</div>
                    </div>
                    <div class="quantity-control">
                        <button class="quantity-btn" onclick="decreaseEmotion('ì„¤ë ˜')" id="decrease-ì„¤ë ˜">
                            <i class="fas fa-minus"></i>
                        </button>
                        <div class="quantity-display" id="quantity-ì„¤ë ˜">0</div>
                        <button class="quantity-btn" onclick="increaseEmotion('ì„¤ë ˜')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <div class="emotion-card bg-red-700 hover:bg-red-600 text-white rounded-xl shadow-lg relative">
                    <div class="emotion-main" onclick="addEmotion('ìŠ¤íŠ¸ë ˆìŠ¤')">
                        <div class="emotion-emoji">ğŸ˜¤</div>
                        <div class="emotion-name">ìŠ¤íŠ¸ë ˆìŠ¤</div>
                        <div class="emotion-count" id="count-ìŠ¤íŠ¸ë ˆìŠ¤">0ëª…</div>
                    </div>
                    <div class="quantity-control">
                        <button class="quantity-btn" onclick="decreaseEmotion('ìŠ¤íŠ¸ë ˆìŠ¤')" id="decrease-ìŠ¤íŠ¸ë ˆìŠ¤">
                            <i class="fas fa-minus"></i>
                        </button>
                        <div class="quantity-display" id="quantity-ìŠ¤íŠ¸ë ˆìŠ¤">0</div>
                        <button class="quantity-btn" onclick="increaseEmotion('ìŠ¤íŠ¸ë ˆìŠ¤')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì˜¤ëŠ˜ í†µê³„ í˜ì´ì§€ -->
        <div id="today-stats-page" class="tab-content hidden">
            <div class="bg-white bg-opacity-10 rounded-xl p-6">
                <h2 class="text-2xl font-bold text-white mb-6 text-center">ì˜¤ëŠ˜ì˜ ê°ì • í†µê³„</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <canvas id="todayChart"></canvas>
                    </div>
                    
                    <div class="text-white">
                        <div class="bg-white bg-opacity-20 rounded-lg p-4 mb-4">
                            <h3 class="text-lg font-bold mb-2">ğŸ“Š ìš”ì•½</h3>
                            <p>ì´ ì°¸ì—¬ ì¸ì›: <span id="total-participants" class="font-bold">0ëª…</span></p>
                            <p>ê°€ì¥ ë§ì€ ê°ì •: <span id="top-emotion" class="font-bold">-</span></p>
                        </div>
                        
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <h3 class="text-lg font-bold mb-2">ğŸ’¡ ì˜¤ëŠ˜ì˜ ì¡°ì–¸</h3>
                            <p id="advice-message" class="text-sm leading-relaxed">ì•„ì§ ì²´í¬ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì£¼ê°„ í†µê³„ í˜ì´ì§€ -->
        <div id="weekly-stats-page" class="tab-content hidden">
            <div class="bg-white bg-opacity-10 rounded-xl p-6">
                <h2 class="text-2xl font-bold text-white mb-6 text-center">ì£¼ê°„ ê°ì • íŠ¸ë Œë“œ</h2>
                
                <div class="chart-container">
                    <canvas id="weeklyChart"></canvas>
                </div>
                
                <div class="mt-6 bg-white bg-opacity-20 rounded-lg p-4">
                    <h3 class="text-lg font-bold text-white mb-2">ğŸ“ˆ ì£¼ê°„ ì¸ì‚¬ì´íŠ¸</h3>
                    <p id="weekly-insight" class="text-white text-sm">ì£¼ê°„ ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
                </div>
            </div>
        </div>

        <!-- ê´€ë¦¬ì í˜ì´ì§€ -->
        <div id="admin-page" class="tab-content hidden">
            <div class="bg-white bg-opacity-10 rounded-xl p-6">
                <h2 class="text-2xl font-bold text-white mb-6 text-center">ê´€ë¦¬ì í˜ì´ì§€</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- ë°ì´í„° ê´€ë¦¬ -->
                    <div class="bg-white bg-opacity-20 rounded-lg p-4">
                        <h3 class="text-lg font-bold text-white mb-4">ğŸ“Š ë°ì´í„° ê´€ë¦¬</h3>
                        
                        <button onclick="exportData()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-2 transition-all">
                            <i class="fas fa-download mr-2"></i>ë°ì´í„° ë‚´ë³´ë‚´ê¸° (CSV)
                        </button>
                        
                        <button onclick="clearTodayData()" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded mb-2 transition-all">
                            <i class="fas fa-refresh mr-2"></i>ì˜¤ëŠ˜ ë°ì´í„° ì´ˆê¸°í™”
                        </button>
                        
                        <button onclick="showAllData()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-2 transition-all">
                            <i class="fas fa-eye mr-2"></i>ì „ì²´ ë°ì´í„° ë³´ê¸°
                        </button>
                    </div>
                    
                    <!-- ë°ì´í„° ë³µì› -->
                    <div class="bg-white bg-opacity-20 rounded-lg p-4">
                        <h3 class="text-lg font-bold text-white mb-4">ğŸ“¥ ë°ì´í„° ë³µì›</h3>
                        
                        <input type="file" id="restore-file" accept=".json,.csv" class="w-full bg-white bg-opacity-20 text-white rounded py-2 px-3 mb-2">
                        
                        <button onclick="restoreData()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded mb-2 transition-all">
                            <i class="fas fa-upload mr-2"></i>ë°ì´í„° ë³µì›í•˜ê¸°
                        </button>
                        
                        <div id="restore-log" class="text-xs text-white opacity-80 mt-2 max-h-32 overflow-y-auto"></div>
                    </div>
                </div>
                
                <!-- ì „ì²´ ë°ì´í„° ë³´ê¸° -->
                <div id="all-data-section" class="mt-6 bg-white bg-opacity-20 rounded-lg p-4 hidden">
                    <h3 class="text-lg font-bold text-white mb-4">ğŸ“‹ ì €ì¥ëœ ëª¨ë“  ë°ì´í„°</h3>
                    <div id="all-data-content" class="text-white text-sm max-h-64 overflow-y-auto"></div>
                </div>
                
                <!-- ë””ë²„ê·¸ ì •ë³´ -->
                <div class="mt-6 bg-white bg-opacity-20 rounded-lg p-4">
                    <h3 class="text-lg font-bold text-white mb-4">ğŸ” ì‹œìŠ¤í…œ ì •ë³´</h3>
                    <div id="debug-info" class="text-white text-xs"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let todayData = {};
        let historyData = {};
        let todayChart = null;
        let weeklyChart = null;
        
        const emotions = ['ê¸°ì¨', 'ë³´í†µ', 'ìŠ¬í””', 'í™”ë‚¨', 'ë¶ˆì•ˆ', 'í”¼ê³¤', 'ì„¤ë ˜', 'ìŠ¤íŠ¸ë ˆìŠ¤'];
        const emotionColors = {
            'ê¸°ì¨': '#FCD34D',
            'ë³´í†µ': '#9CA3AF', 
            'ìŠ¬í””': '#3B82F6',
            'í™”ë‚¨': '#EF4444',
            'ë¶ˆì•ˆ': '#F97316',
            'í”¼ê³¤': '#7C3AED',
            'ì„¤ë ˜': '#EC4899',
            'ìŠ¤íŠ¸ë ˆìŠ¤': '#B91C1C'
        };

        // í˜„ì¬ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸° (í•­ìƒ ì‹¤ì œ ì˜¤ëŠ˜ ë‚ ì§œ)
        function getTodayString() {
            const today = new Date();
            return today.getFullYear() + '-' + 
                   String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                   String(today.getDate()).padStart(2, '0');
        }

        // ë‚ ì§œ í‘œì‹œ í¬ë§·
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.getFullYear() + 'ë…„ ' + 
                   (date.getMonth() + 1) + 'ì›” ' + 
                   date.getDate() + 'ì¼';
        }

        // ì´ˆê¸°í™”
        function init() {
            const todayString = getTodayString();
            document.getElementById('currentDate').textContent = formatDate(todayString);
            
            // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ
            loadData();
            
            // ë‚ ì§œê°€ ë°”ë€Œì—ˆëŠ”ì§€ í™•ì¸
            checkDateChange();
            
            updateDisplay();
            updateDebugInfo();
        }

        // ë°ì´í„° ë¡œë“œ
        function loadData() {
            const savedData = localStorage.getItem('emotionData');
            const savedHistory = localStorage.getItem('emotionHistory');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    todayData = data.todayData || {};
                    historyData = data.historyData || {};
                } catch (e) {
                    console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', e);
                    todayData = {};
                    historyData = {};
                }
            }
            
            if (savedHistory) {
                try {
                    const history = JSON.parse(savedHistory);
                    Object.assign(historyData, history);
                } catch (e) {
                    console.error('íˆìŠ¤í† ë¦¬ ë¡œë“œ ì˜¤ë¥˜:', e);
                }
            }

            // ì˜¤ëŠ˜ ë°ì´í„° ì´ˆê¸°í™” (ì‹¤ì œ ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€)
            const todayString = getTodayString();
            if (!todayData[todayString]) {
                todayData[todayString] = {};
                emotions.forEach(emotion => {
                    todayData[todayString][emotion] = 0;
                });
            }
        }

        // ë‚ ì§œ ë³€ê²½ í™•ì¸ ë° ì²˜ë¦¬
        function checkDateChange() {
            const todayString = getTodayString();
            const lastSavedDate = localStorage.getItem('lastSavedDate');
            
            if (lastSavedDate && lastSavedDate !== todayString) {
                // ë‚ ì§œê°€ ë°”ë€œ - ì–´ì œ ë°ì´í„°ë¥¼ íˆìŠ¤í† ë¦¬ë¡œ ì´ë™
                if (todayData[lastSavedDate]) {
                    historyData[lastSavedDate] = { ...todayData[lastSavedDate] };
                    delete todayData[lastSavedDate];
                }
                
                // ì˜¤ëŠ˜ ë°ì´í„° ì´ˆê¸°í™”
                todayData[todayString] = {};
                emotions.forEach(emotion => {
                    todayData[todayString][emotion] = 0;
                });
                
                saveData();
            }
            
            localStorage.setItem('lastSavedDate', todayString);
        }

        // ë°ì´í„° ì €ì¥
        function saveData() {
            const dataToSave = {
                todayData: todayData,
                historyData: historyData,
                lastSaved: new Date().toISOString(),
                version: '3.5'
            };
            
            localStorage.setItem('emotionData', JSON.stringify(dataToSave));
            localStorage.setItem('emotionHistory', JSON.stringify(historyData));
            localStorage.setItem('lastSavedDate', getTodayString());
        }

        // ê°ì • ì¶”ê°€
        function addEmotion(emotion) {
            const todayString = getTodayString();
            
            if (!todayData[todayString]) {
                todayData[todayString] = {};
                emotions.forEach(e => {
                    todayData[todayString][e] = 0;
                });
            }
            
            todayData[todayString][emotion]++;
            updateDisplay();
            saveData();
        }

        // ê°ì • ì¦ê°€
        function increaseEmotion(emotion) {
            const todayString = getTodayString();
            
            if (!todayData[todayString]) {
                todayData[todayString] = {};
                emotions.forEach(e => {
                    todayData[todayString][e] = 0;
                });
            }
            
            todayData[todayString][emotion]++;
            updateDisplay();
            saveData();
        }

        // ê°ì • ê°ì†Œ
        function decreaseEmotion(emotion) {
            const todayString = getTodayString();
            
            if (!todayData[todayString]) {
                todayData[todayString] = {};
                emotions.forEach(e => {
                    todayData[todayString][e] = 0;
                });
            }
            
            if (todayData[todayString][emotion] > 0) {
                todayData[todayString][emotion]--;
                updateDisplay();
                saveData();
            }
        }

        // í™”ë©´ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            const todayString = getTodayString();
            const today = todayData[todayString] || {};
            
            // ë²„íŠ¼ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            emotions.forEach(emotion => {
                const count = today[emotion] || 0;
                const element = document.getElementById(`count-${emotion}`);
                const quantityElement = document.getElementById(`quantity-${emotion}`);
                const decreaseBtn = document.getElementById(`decrease-${emotion}`);
                
                if (element) {
                    element.textContent = count + 'ëª…';
                }
                if (quantityElement) {
                    quantityElement.textContent = count;
                }
                if (decreaseBtn) {
                    decreaseBtn.disabled = count === 0;
                }
            });
            
            updateTodayStats();
            updateWeeklyStats();
        }

        // ì˜¤ëŠ˜ í†µê³„ ì—…ë°ì´íŠ¸
        function updateTodayStats() {
            const todayString = getTodayString();
            const today = todayData[todayString] || {};
            
            const total = Object.values(today).reduce((sum, count) => sum + count, 0);
            document.getElementById('total-participants').textContent = total + 'ëª…';
            
            if (total === 0) {
                document.getElementById('top-emotion').textContent = '-';
                document.getElementById('advice-message').textContent = 'ì•„ì§ ì²´í¬ì¸ì´ ì—†ìŠµë‹ˆë‹¤.';
                return;
            }
            
            // ê°€ì¥ ë§ì€ ê°ì • ì°¾ê¸°
            let topEmotion = '';
            let maxCount = 0;
            let topPercentage = 0;
            
            emotions.forEach(emotion => {
                const count = today[emotion] || 0;
                if (count > maxCount) {
                    maxCount = count;
                    topEmotion = emotion;
                    topPercentage = Math.round((count / total) * 100);
                }
            });
            
            document.getElementById('top-emotion').textContent = `${topEmotion} (${topPercentage}%)`;
            
            // ì¡°ì–¸ ë©”ì‹œì§€ ì„¤ì •
            setAdviceMessage(topEmotion, topPercentage);
            
            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateTodayChart(today, total);
        }

        // ì¡°ì–¸ ë©”ì‹œì§€ ì„¤ì •
        function setAdviceMessage(emotion, percentage) {
            const messages = {
                'ê¸°ì¨': {
                    high: "ìš°ì™€! ì˜¤ëŠ˜ ìš°ë¦¬ë°˜ ì—ë„ˆì§€ê°€ ì •ë§ ì¢‹ë„¤ìš”! ì´ëŸ° ì¢‹ì€ ë¶„ìœ„ê¸°ë¥¼ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ë‚˜ëˆ„ì–´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?",
                    medium: "ê¸°ìœ ë§ˆìŒì´ ê°€ë“í•œ í•˜ë£¨ë„¤ìš”! ê¸ì •ì ì¸ ì—ë„ˆì§€ë¥¼ ê³„ì† ìœ ì§€í•´ë³´ì•„ìš”.",
                    low: "ì¢‹ì€ ì¼ì´ ìˆì—ˆë‚˜ ë´ìš”! ì‘ì€ ê¸°ì¨ë„ ì†Œì¤‘íˆ ê°„ì§í•´ë³´ì„¸ìš”."
                },
                'í”¼ê³¤': {
                    high: "ì˜¤ëŠ˜ í”¼ê³¤í•œ ì¹œêµ¬ë“¤ì´ ë§ë„¤ìš”. ì ê¹ ìŠ¤íŠ¸ë ˆì¹­í•˜ê±°ë‚˜ ê¹Šê²Œ ìˆ¨ì‰¬ê¸°ë¥¼ í•´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”? ì¶©ë¶„í•œ íœ´ì‹ë„ ì¤‘ìš”í•´ìš”!",
                    medium: "ì¡°ê¸ˆ í”¼ê³¤í•œ í•˜ë£¨ì¸ ê²ƒ ê°™ì•„ìš”. ë¬´ë¦¬í•˜ì§€ ë§ê³  ì ë‹¹í•œ íœ´ì‹ì„ ì·¨í•´ë³´ì„¸ìš”.",
                    low: "í”¼ê³¤í•¨ì„ ëŠë¼ëŠ” ì¹œêµ¬ë“¤ì´ ìˆë„¤ìš”. ëª¸ê³¼ ë§ˆìŒì„ ì˜ ëŒë´ì£¼ì„¸ìš”."
                },
                'ìŠ¤íŠ¸ë ˆìŠ¤': {
                    high: "ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ëŠ” ì¼ì´ ìˆì—ˆë‚˜ìš”? ì¹œêµ¬ë“¤ê³¼ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ê±°ë‚˜ ì„ ìƒë‹˜ê»˜ ë„ì›€ì„ ìš”ì²­í•´ë³´ì„¸ìš”. í˜¼ì í•´ê²°í•˜ë ¤ í•˜ì§€ ë§ê³  í•¨ê»˜í•´ìš”!",
                    medium: "ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ìˆëŠ” í•˜ë£¨êµ°ìš”. ê¹Šê²Œ ìˆ¨ì„ ì‰¬ê³  ë§ˆìŒì„ ì§„ì •ì‹œì¼œë³´ì„¸ìš”.",
                    low: "ì•½ê°„ì˜ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ìˆëŠ” ê²ƒ ê°™ì•„ìš”. ê°€ë²¼ìš´ ìš´ë™ì´ë‚˜ ì¢‹ì•„í•˜ëŠ” í™œë™ì„ í•´ë³´ì„¸ìš”."
                },
                'ìŠ¬í””': {
                    high: "ë§ˆìŒì´ ë¬´ê±°ìš´ ë‚ ì´êµ°ìš”. ê´œì°®ì•„ìš”, ëˆ„êµ¬ì—ê²Œë‚˜ ê·¸ëŸ° ë‚ ì´ ìˆì–´ìš”. ì˜¤ëŠ˜ì€ ì„œë¡œë¥¼ ë” ë”°ëœ»í•˜ê²Œ ë°°ë ¤í•´ë³´ì•„ìš”.",
                    medium: "ì¡°ê¸ˆ ìš°ìš¸í•œ ê¸°ë¶„ì¸ ê²ƒ ê°™ì•„ìš”. ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ìˆìœ¼ë©´ ê¸°ë¶„ì´ ë‚˜ì•„ì§ˆ ê±°ì˜ˆìš”.",
                    low: "ë§ˆìŒì´ ì¡°ê¸ˆ ë¬´ê±°ìš´ ì¹œêµ¬ë“¤ì´ ìˆë„¤ìš”. ì„œë¡œ ìœ„ë¡œí•´ì£¼ëŠ” í•˜ë£¨ê°€ ë˜ê¸¸ ë°”ë¼ìš”."
                },
                'í™”ë‚¨': {
                    high: "í™”ê°€ ë‚˜ëŠ” ì¼ì´ ìˆì—ˆë‚˜ìš”? ê¹Šê²Œ ìˆ¨ì„ ì‰¬ê³  ë§ˆìŒì„ ì§„ì •ì‹œì¼œë³´ì„¸ìš”. ë¬¸ì œê°€ ìˆë‹¤ë©´ ì°¨ë¶„íˆ ì´ì•¼ê¸°ë¡œ í•´ê²°í•´ë³´ì•„ìš”.",
                    medium: "ì§œì¦ë‚˜ëŠ” ì¼ì´ ìˆì—ˆë‚˜ ë´ìš”. ì ì‹œ ë§ˆìŒì„ ê°€ë¼ì•‰íˆê³  ê¸ì •ì ì¸ ìƒê°ì„ í•´ë³´ì„¸ìš”.",
                    low: "í™”ê°€ ë‚˜ëŠ” ì¹œêµ¬ë“¤ì´ ìˆë„¤ìš”. ë§ˆìŒì„ ì°¨ë¶„íˆ ê°€ì§€ê³  ì„œë¡œ ì´í•´í•´ë³´ì•„ìš”."
                },
                'ë¶ˆì•ˆ': {
                    high: "ê±±ì •ì´ë‚˜ ë¶ˆì•ˆí•œ ë§ˆìŒì´ ìˆëŠ” ê²ƒ ê°™ì•„ìš”. í•¨ê»˜ ì´ì•¼ê¸°í•˜ë©´ í•´ê²°ì±…ì„ ì°¾ì„ ìˆ˜ ìˆì„ ê±°ì˜ˆìš”. í˜¼ì ê±±ì •í•˜ì§€ ë§ê³  ë„ì›€ì„ ìš”ì²­í•´ë³´ì„¸ìš”.",
                    medium: "ë¶ˆì•ˆí•œ ë§ˆìŒì´ ìˆë‚˜ ë´ìš”. ì¹œêµ¬ë“¤ì´ë‚˜ ì„ ìƒë‹˜ê³¼ ì´ì•¼ê¸°í•´ë³´ì„¸ìš”.",
                    low: "ì•½ê°„ì˜ ê±±ì •ì´ ìˆëŠ” ê²ƒ ê°™ì•„ìš”. ê¸ì •ì ìœ¼ë¡œ ìƒê°í•˜ë ¤ê³  ë…¸ë ¥í•´ë³´ì„¸ìš”."
                },
                'ì„¤ë ˜': {
                    high: "ì„¤ë ˆëŠ” ì¼ì´ ìˆë‚˜ ë´ìš”! ì¢‹ì€ ê¸°ëŒ€ê°ì„ ì¹œêµ¬ë“¤ê³¼ ë‚˜ëˆ„ì–´ë³´ì„¸ìš”. ê¸ì •ì ì¸ ì—ë„ˆì§€ê°€ ë” ì»¤ì§ˆ ê±°ì˜ˆìš”!",
                    medium: "ê¸°ëŒ€ë˜ëŠ” ì¼ì´ ìˆë‚˜ ë´ìš”! ì„¤ë ˆëŠ” ë§ˆìŒì„ ê°„ì§í•˜ì„¸ìš”.",
                    low: "ì¢‹ì€ ì¼ì„ ê¸°ëŒ€í•˜ëŠ” ì¹œêµ¬ë“¤ì´ ìˆë„¤ìš”. í¬ë§ì°¬ í•˜ë£¨ê°€ ë˜ê¸¸ ë°”ë¼ìš”."
                },
                'ë³´í†µ': {
                    high: "í‰ì˜¨í•œ í•˜ë£¨ë„¤ìš”. ì´ëŸ° ì•ˆì •ì ì¸ ë¶„ìœ„ê¸°ë„ ì¢‹ì•„ìš”. ì˜¤ëŠ˜ì€ ìƒˆë¡œìš´ ê²ƒì— ë„ì „í•´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?",
                    medium: "ì°¨ë¶„í•˜ê³  ì•ˆì •ì ì¸ ë¶„ìœ„ê¸°ì˜ˆìš”. ì´ëŸ° í‰ì˜¨í•¨ë„ ì†Œì¤‘í•´ìš”.",
                    low: "í‰ë²”í•˜ì§€ë§Œ ì•ˆì •ì ì¸ í•˜ë£¨ë„¤ìš”. ì‘ì€ í–‰ë³µì„ ì°¾ì•„ë³´ì„¸ìš”."
                }
            };
            
            const emotionMessages = messages[emotion];
            let message = "ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ ë³´ë‚´ì„¸ìš”!";
            
            if (emotionMessages) {
                if (percentage >= 40) {
                    message = emotionMessages.high;
                } else if (percentage >= 25) {
                    message = emotionMessages.medium;
                } else {
                    message = emotionMessages.low;
                }
            }
            
            document.getElementById('advice-message').textContent = message;
        }

        // ì˜¤ëŠ˜ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateTodayChart(data, total) {
            const ctx = document.getElementById('todayChart').getContext('2d');
            
            if (todayChart) {
                todayChart.destroy();
            }
            
            const chartData = emotions.map(emotion => data[emotion] || 0);
            const labels = emotions.map(emotion => {
                const count = data[emotion] || 0;
                const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
                return `${emotion} (${count}ëª…, ${percentage}%)`;
            });
            
            todayChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: chartData,
                        backgroundColor: emotions.map(emotion => emotionColors[emotion]),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'white',
                                font: {
                                    size: 12
                                },
                                filter: function(legendItem, chartData) {
                                    return chartData.datasets[0].data[legendItem.index] > 0;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ì£¼ê°„ í†µê³„ ì—…ë°ì´íŠ¸
        function updateWeeklyStats() {
            const weeklyData = getWeeklyData();
            updateWeeklyChart(weeklyData);
            updateWeeklyInsight(weeklyData);
        }

        // ì£¼ê°„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getWeeklyData() {
            const today = new Date();
            const weekData = {};
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateString = date.getFullYear() + '-' + 
                                 String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                                 String(date.getDate()).padStart(2, '0');
                
                const dayName = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()];
                
                // ì˜¤ëŠ˜ ë°ì´í„° ë˜ëŠ” íˆìŠ¤í† ë¦¬ ë°ì´í„°ì—ì„œ ê°€ì ¸ì˜¤ê¸°
                const dayData = todayData[dateString] || historyData[dateString] || {};
                
                weekData[dayName] = dayData;
            }
            
            return weekData;
        }

        // ì£¼ê°„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateWeeklyChart(weeklyData) {
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            
            if (weeklyChart) {
                weeklyChart.destroy();
            }
            
            const days = Object.keys(weeklyData);
            const datasets = emotions.map(emotion => ({
                label: emotion,
                data: days.map(day => weeklyData[day][emotion] || 0),
                backgroundColor: emotionColors[emotion],
                borderColor: emotionColors[emotion],
                borderWidth: 1
            }));
            
            weeklyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: days,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            }
                        }
                    }
                }
            });
        }

        // ì£¼ê°„ ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸
        function updateWeeklyInsight(weeklyData) {
            const days = Object.keys(weeklyData);
            const insights = [];
            
            // ìš”ì¼ë³„ ì£¼ìš” ê°ì • ë¶„ì„
            days.forEach(day => {
                const dayData = weeklyData[day];
                const total = Object.values(dayData).reduce((sum, count) => sum + count, 0);
                
                if (total > 0) {
                    let topEmotion = '';
                    let maxCount = 0;
                    
                    emotions.forEach(emotion => {
                        const count = dayData[emotion] || 0;
                        if (count > maxCount) {
                            maxCount = count;
                            topEmotion = emotion;
                        }
                    });
                    
                    const percentage = Math.round((maxCount / total) * 100);
                    if (percentage >= 30) {
                        insights.push(`${day}ìš”ì¼ì—ëŠ” '${topEmotion}'ì´ ${percentage}%ë¡œ ë§ì•˜ì–´ìš”.`);
                    }
                }
            });
            
            const insightText = insights.length > 0 ? 
                insights.join(' ') : 
                'ì•„ì§ ì¶©ë¶„í•œ ì£¼ê°„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë” ë§ì€ ë°ì´í„°ê°€ ìŒ“ì´ë©´ íŒ¨í„´ì„ ë¶„ì„í•´ë“œë¦´ê²Œìš”!';
                
            document.getElementById('weekly-insight').textContent = insightText;
        }

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('tab-active');
            });
            
            // ì„ íƒëœ íƒ­ ë³´ì´ê¸°
            document.getElementById(tabName + '-page').classList.remove('hidden');
            document.getElementById('tab-' + tabName).classList.add('tab-active');
            
            // ì°¨íŠ¸ê°€ ìˆëŠ” íƒ­ì˜ ê²½ìš° ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            if (tabName === 'today-stats') {
                setTimeout(updateTodayStats, 100);
            } else if (tabName === 'weekly-stats') {
                setTimeout(updateWeeklyStats, 100);
            } else if (tabName === 'admin') {
                updateDebugInfo();
            }
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportData() {
            const allData = { ...historyData, ...todayData };
            let csvContent = "ë‚ ì§œ,ê°ì •,íšŸìˆ˜,ë¹„ìœ¨\n";
            
            Object.keys(allData).forEach(date => {
                const dayData = allData[date];
                const total = Object.values(dayData).reduce((sum, count) => sum + count, 0);
                
                emotions.forEach(emotion => {
                    const count = dayData[emotion] || 0;
                    const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
                    csvContent += `${date},${emotion},${count},${percentage}%\n`;
                });
            });
            
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ê°ì •ì²´í¬ì¸_${getTodayString()}.csv`;
            link.click();
        }

        // ì˜¤ëŠ˜ ë°ì´í„° ì´ˆê¸°í™”
        function clearTodayData() {
            if (confirm('ì˜¤ëŠ˜ ë°ì´í„°ë¥¼ ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const todayString = getTodayString();
                todayData[todayString] = {};
                emotions.forEach(emotion => {
                    todayData[todayString][emotion] = 0;
                });
                updateDisplay();
                saveData();
                alert('ì˜¤ëŠ˜ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì „ì²´ ë°ì´í„° ë³´ê¸°
        function showAllData() {
            const section = document.getElementById('all-data-section');
            const content = document.getElementById('all-data-content');
            
            let htmlContent = '<h4 class="font-bold mb-2">ğŸ“… ì˜¤ëŠ˜ ë°ì´í„°</h4>';
            Object.keys(todayData).forEach(date => {
                const dayData = todayData[date];
                const total = Object.values(dayData).reduce((sum, count) => sum + count, 0);
                htmlContent += `<div class="mb-2"><strong>${formatDate(date)}</strong> (ì´ ${total}ëª…)<br>`;
                emotions.forEach(emotion => {
                    const count = dayData[emotion] || 0;
                    if (count > 0) {
                        htmlContent += `${emotion}: ${count}ëª… `;
                    }
                });
                htmlContent += '</div>';
            });
            
            htmlContent += '<h4 class="font-bold mb-2 mt-4">ğŸ“š íˆìŠ¤í† ë¦¬ ë°ì´í„°</h4>';
            Object.keys(historyData).forEach(date => {
                const dayData = historyData[date];
                const total = Object.values(dayData).reduce((sum, count) => sum + count, 0);
                htmlContent += `<div class="mb-2"><strong>${formatDate(date)}</strong> (ì´ ${total}ëª…)<br>`;
                emotions.forEach(emotion => {
                    const count = dayData[emotion] || 0;
                    if (count > 0) {
                        htmlContent += `${emotion}: ${count}ëª… `;
                    }
                });
                htmlContent += '</div>';
            });
            
            content.innerHTML = htmlContent;
            section.classList.toggle('hidden');
        }

        // ë°ì´í„° ë³µì› (CSV ì§€ì› ì¶”ê°€)
        function restoreData() {
            const fileInput = document.getElementById('restore-file');
            const file = fileInput.files[0];
            const logDiv = document.getElementById('restore-log');
            
            if (!file) {
                alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            logDiv.innerHTML = 'ğŸ“ íŒŒì¼ ì½ê¸° ì¤‘...<br>';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    let data = {};
                    
                    logDiv.innerHTML += 'âœ… íŒŒì¼ ì½ê¸° ì„±ê³µ<br>';
                    
                    // JSON ë˜ëŠ” CSV íŒŒì‹±
                    if (file.name.endsWith('.json') || content.trim().startsWith('{')) {
                        // JSON íŒŒì¼ ì²˜ë¦¬
                        const jsonData = JSON.parse(content);
                        logDiv.innerHTML += 'âœ… JSON íŒŒì‹± ì„±ê³µ<br>';
                        
                        // ë°ì´í„° êµ¬ì¡° í™•ì¸ ë° ë³€í™˜
                        if (jsonData.todayData || jsonData.historyData) {
                            data = { ...jsonData.todayData, ...jsonData.historyData };
                        } else {
                            data = jsonData;
                        }
                    } else {
                        // CSV íŒŒì¼ ì²˜ë¦¬
                        logDiv.innerHTML += 'ğŸ“Š CSV íŒŒì‹± ì‹œì‘<br>';
                        const lines = content.split('\n');
                        
                        if (lines.length < 2) {
                            throw new Error('CSV íŒŒì¼ì´ ë¹„ì–´ìˆê±°ë‚˜ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        }
                        
                        // í—¤ë” í™•ì¸
                        const header = lines[0].trim();
                        if (!header.includes('ë‚ ì§œ') || !header.includes('ê°ì •') || !header.includes('íšŸìˆ˜')) {
                            throw new Error('CSV íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. "ë‚ ì§œ,ê°ì •,íšŸìˆ˜,ë¹„ìœ¨" í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                        }
                        
                        // ë°ì´í„° íŒŒì‹±
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (!line) continue;
                            
                            const parts = line.split(',');
                            if (parts.length < 3) continue;
                            
                            const date = parts[0].trim();
                            const emotion = parts[1].trim();
                            const count = parseInt(parts[2].trim()) || 0;
                            
                            // ë‚ ì§œ í˜•ì‹ ê²€ì¦
                            if (!/^\d{4}-\d{2}-\d{2}$/.test(date)) continue;
                            
                            // ê°ì • ê²€ì¦
                            if (!emotions.includes(emotion)) continue;
                            
                            // ë°ì´í„° ì €ì¥
                            if (!data[date]) {
                                data[date] = {};
                                emotions.forEach(e => {
                                    data[date][e] = 0;
                                });
                            }
                            
                            data[date][emotion] = count;
                        }
                        
                        logDiv.innerHTML += 'âœ… CSV íŒŒì‹± ì™„ë£Œ<br>';
                    }
                    
                    // ë°ì´í„° ë³µì›
                    let restoredCount = 0;
                    const todayString = getTodayString();
                    
                    Object.keys(data).forEach(date => {
                        if (date === 'meta' || date === 'exportDate' || date === 'version') return;
                        
                        const dayData = data[date];
                        
                        // ë‚ ì§œ ê²€ì¦
                        if (!/^\d{4}-\d{2}-\d{2}$/.test(date)) return;
                        
                        if (date === todayString) {
                            // ì˜¤ëŠ˜ ë°ì´í„°ëŠ” todayDataì— ì €ì¥
                            logDiv.innerHTML += `ğŸ“… ì˜¤ëŠ˜ ë°ì´í„° (${date}) ë³µì› ì¤‘...<br>`;
                            todayData[date] = {};
                            emotions.forEach(emotion => {
                                todayData[date][emotion] = dayData[emotion] || 0;
                            });
                        } else {
                            // ê³¼ê±° ë°ì´í„°ëŠ” historyDataì— ì €ì¥
                            logDiv.innerHTML += `ğŸ“š ê³¼ê±° ë°ì´í„° (${date}) ë³µì› ì¤‘...<br>`;
                            historyData[date] = {};
                            emotions.forEach(emotion => {
                                historyData[date][emotion] = dayData[emotion] || 0;
                            });
                        }
                        restoredCount++;
                    });
                    
                    logDiv.innerHTML += `âœ… ${restoredCount}ê°œ ë‚ ì§œ ë°ì´í„° ë³µì› ì™„ë£Œ<br>`;
                    logDiv.innerHTML += 'ğŸ’¾ ë°ì´í„° ì €ì¥ ì¤‘...<br>';
                    
                    saveData();
                    updateDisplay();
                    
                    logDiv.innerHTML += 'âœ… ë³µì› ì™„ë£Œ!<br>';
                    logDiv.innerHTML += `ğŸ“Š í˜„ì¬ ì˜¤ëŠ˜: ${todayString}<br>`;
                    
                    alert(`ë°ì´í„° ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\në³µì›ëœ ë‚ ì§œ: ${restoredCount}ê°œ`);
                    
                } catch (error) {
                    console.error('ë³µì› ì˜¤ë¥˜:', error);
                    logDiv.innerHTML += `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}<br>`;
                    alert('ë°ì´í„° ë³µì› ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            
            reader.readAsText(file, 'UTF-8');
        }

        // ë””ë²„ê·¸ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateDebugInfo() {
            const debugDiv = document.getElementById('debug-info');
            const todayString = getTodayString();
            
            const info = [
                `í˜„ì¬ ë‚ ì§œ: ${todayString}`,
                `ì €ì¥ëœ ì˜¤ëŠ˜ ë°ì´í„° í‚¤: ${Object.keys(todayData).join(', ') || 'ì—†ìŒ'}`,
                `ì €ì¥ëœ íˆìŠ¤í† ë¦¬ í‚¤: ${Object.keys(historyData).join(', ') || 'ì—†ìŒ'}`,
                `ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í¬ê¸°: ${JSON.stringify(todayData).length + JSON.stringify(historyData).length} bytes`,
                `ë§ˆì§€ë§‰ ì €ì¥: ${localStorage.getItem('lastSavedDate') || 'ì—†ìŒ'}`,
                `ì‹œìŠ¤í…œ ë²„ì „: 3.5`
            ];
            
            debugDiv.innerHTML = info.join('<br>');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            init();
        };
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDsXB6d2qb3W2pjSvxPEw7ahopuSLHwBd9dCl0AzkPd9buFC7J4gZDPJ%2F1eK6af1tMCgjLLOn7zkp1sEq2QvdbJOT%2B4gZSOXAJVicQFhUxwGZ%2Fip8o%2FBNjIHpoPrErzwc8OKyMp850bcXNyzwWmg6nfbMwCub2%2BiIpod8vaTY2x9JoxpNH2JXD%2B8L%2FMmlJQNB5blDNz%2F0xKTdTbfrxROzwoRYlqGoP3r4iA%2BBRLklujSFhsIC6Aduiu7MeZSctaPNsg%2Fn0yrchzWWS9i%2BGErGsZUzGMC7RxfbwjQQpAMfnywac0ISsYKJAxYAhlOFIJIA%2B9HMz3pvmrdaXP6Lfwi%2F3tGR7QunrsDwQslCqepzFwT07W8geYQh8mpOYncVJTDAfZss1SYDB5qGWPgnxUdo0DqtPI%2BVRjaJSMI2ELxTL26I9IqHfRz8QCyZvRs8wA%2F7DzZSaOYC3GHuOFp%2FICtOWJ9hSHj9gqxasGASTmVpUZ9yzxHwLif0X7heaIDU5wMTFAa%2Fv7U2lwWd3TDD43Wd5rc%3D";
        window.__genspark_locale = "ko-KR";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDsXB6d2qb3W2pjSvxPEw7ahopuSLHwBd9dCl0AzkPd9buFC7J4gZDPJ/1eK6af1tMCgjLLOn7zkp1sEq2QvdbJOT+4gZSOXAJVicQFhUxwGZ/ip8o/BNjIHpoPrErzwc8OKyMp850bcXNyzwWmg6nfbMwCub2+iIpod8vaTY2x9JoxpNH2JXD+8L/MmlJQNB5blDNz/0xKTdTbfrxROzwoRYlqGoP3r4iA+BRLklujSFhsIC6Aduiu7MeZSctaPNsg/n0yrchzWWS9i+GErGsZUzGMC7RxfbwjQQpAMfnywac0ISsYKJAxYAhlOFIJIA+9HMz3pvmrdaXP6Lfwi/3tGR7QunrsDwQslCqepzFwT07W8geYQh8mpOYncVJTDAfZss1SYDB5qGWPgnxUdo0DqtPI+VRjaJSMI2ELxTL26I9IqHfRz8QCyZvRs8wA/7DzZSaOYC3GHuOFp/ICtOWJ9hSHj9gqxasGASTmVpUZ9yzxHwLif0X7heaIDU5wMTFAa/v7U2lwWd3TDD43Wd5rc=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
